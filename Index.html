<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roleta do Mike</title>
  <link rel="icon" type="image/png" href="https://i.imgur.com/XOEcuO8.png">
  <style>
    :root {
      --cor-dourado: #d1a720;
      --cor-fundo: #1a1a1a;
      --cor-card: rgba(40, 35, 25, 0.95);
      --cor-texto: #f5f5f5;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, rgba(20,20,20,0.9), rgba(40,30,20,0.9)),
                  url("https://i.imgur.com/vATNRmF.png") no-repeat center center fixed;
      background-size: cover;
      color: var(--cor-texto);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(20,20,20,0.9);
      border-bottom: 2px solid var(--cor-dourado);
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
      z-index: 1000;
    }
    header img { height: 42px; }
    header h1 { font-size: 1.6rem; color: var(--cor-dourado); }
    main {
      margin-top: 100px;
      display: flex; gap: 40px;
      justify-content: center; align-items: flex-start;
      width: 100%; max-width: 1100px; padding: 20px;
    }
    .roleta-container { position: relative; width: 400px; height: 400px; }
    canvas {
      width: 100%; height: 100%; border-radius: 50%;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      background: #222;
    }
    .ponteiro {
      position: absolute; top: -35px; left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 18px solid transparent;
      border-right: 18px solid transparent;
      border-top: 35px solid #fff;
      filter: drop-shadow(0 0 3px black);
      z-index: 10;
    }
    .botao {
      margin-top: 20px; padding: 12px 24px;
      font-size: 1rem; font-weight: bold;
      border: none; border-radius: 10px; cursor: pointer;
      background: var(--cor-dourado); color: #111;
      transition: transform .2s;
    }
    .botao:hover { transform: scale(1.05); }
    .lista {
      flex: 1; background: var(--cor-card);
      padding: 20px; border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.6);
    }
    .lista h2 {
      margin-bottom: 12px; font-size: 1.3rem;
      color: var(--cor-dourado); text-align: center;
    }
    .lista table { width: 100%; border-collapse: collapse; }
    .lista th, .lista td {
      padding: 8px; text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .lista input {
      width: 80%; padding: 5px;
      border-radius: 6px; border: none;
      text-align: center;
    }
    .remover {
      cursor: pointer; color: red; font-weight: bold;
      border: none; background: transparent; font-size: 1.1rem;
    }
    .add-btn {
      margin-top: 15px; width: 100%;
      background: #28a745; color: white;
      font-weight: bold; border: none;
      padding: 10px; border-radius: 8px;
      cursor: pointer;
    }
    .add-btn:hover { background: #218838; }
  </style>
</head>
<body>
  <header>
    <img src="https://i.imgur.com/XOEcuO8.png" alt="Mascote">
    <h1>Roleta do Mike</h1>
  </header>

  <main>
    <div class="roleta-container">
      <div class="ponteiro"></div>
      <canvas id="roleta" width="400" height="400"></canvas>
      <button class="botao" onclick="girar()">Girar</button>
    </div>

    <div class="lista">
      <h2>Itens da Roleta</h2>
      <table id="tabela">
        <thead>
          <tr><th>Item</th><th>%</th><th></th></tr>
        </thead>
        <tbody>
          <tr>
            <td><input value="Item 1"></td>
            <td><input type="number" value="50"></td>
            <td><button class="remover" onclick="removerLinha(this)">❌</button></td>
          </tr>
          <tr>
            <td><input value="Item 2"></td>
            <td><input type="number" value="50"></td>
            <td><button class="remover" onclick="removerLinha(this)">❌</button></td>
          </tr>
        </tbody>
      </table>
      <button class="add-btn" onclick="adicionarLinha()">+ Adicionar Recompensa</button>
    </div>
  </main>

  <script>
    const canvas = document.getElementById("roleta");
    const ctx = canvas.getContext("2d");
    let anguloAtual = 0;

    function getItens() {
      const linhas = document.querySelectorAll("#tabela tbody tr");
      let itens = [];
      linhas.forEach(linha => {
        const nome = linha.cells[0].querySelector("input").value;
        const perc = parseFloat(linha.cells[1].querySelector("input").value) || 0;
        if (nome && perc > 0) itens.push({ nome, perc });
      });
      return itens;
    }

    function normalizarPercentuais() {
      const linhas = document.querySelectorAll("#tabela tbody tr");
      let soma = 0;
      linhas.forEach(l => soma += parseFloat(l.cells[1].querySelector("input").value) || 0);
      if (soma === 0) return;

      linhas.forEach(linha => {
        const inp = linha.cells[1].querySelector("input");
        let valor = parseFloat(inp.value) || 0;
        inp.value = ((valor / soma) * 100).toFixed(2);
      });
    }

    function desenharRoleta() {
      normalizarPercentuais();
      const itens = getItens();
      const total = 100;
      let anguloInicio = 0;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.save();
      ctx.translate(canvas.width/2, canvas.height/2);
      ctx.rotate(anguloAtual);

      itens.forEach((item, index) => {
        const angulo = (item.perc / total) * 2 * Math.PI;

        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.arc(0, 0, canvas.width/2, anguloInicio, anguloInicio + angulo);
        ctx.closePath();
        ctx.fillStyle = `hsl(${index * 70}, 70%, 50%)`;
        ctx.fill();
        ctx.stroke();

        ctx.save();
        ctx.rotate(anguloInicio + angulo/2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#fff";
        ctx.font = "16px Arial";
        ctx.fillText(`${item.nome} (${item.perc}%)`, canvas.width/2 - 10, 10);
        ctx.restore();

        anguloInicio += angulo;
      });

      ctx.restore();
    }

    function girar() {
      let anguloFinal = anguloAtual + (Math.random() * Math.PI * 4 + Math.PI * 6);
      let duracao = 3000;
      let inicio = null;

      function animar(timestamp) {
        if (!inicio) inicio = timestamp;
        let progresso = (timestamp - inicio) / duracao;
        if (progresso < 1) {
          anguloAtual = anguloFinal * easeOutCubic(progresso);
          desenharRoleta();
          requestAnimationFrame(animar);
        } else {
          anguloAtual = anguloFinal;
          desenharRoleta();
        }
      }
      requestAnimationFrame(animar);
    }

    function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }

    function removerLinha(btn) {
      btn.closest("tr").remove();
      desenharRoleta();
    }

    function adicionarLinha() {
      const tbody = document.querySelector("#tabela tbody");
      const nova = document.createElement("tr");
      nova.innerHTML = `
        <td><input value="Novo Item"></td>
        <td><input type="number" value="0"></td>
        <td><button class="remover" onclick="removerLinha(this)">❌</button></td>
      `;
      tbody.appendChild(nova);
      recalcularDistribuicao();
      nova.querySelectorAll("input").forEach(inp => inp.addEventListener("input", desenharRoleta));
    }

    function recalcularDistribuicao() {
      const linhas = document.querySelectorAll("#tabela tbody tr");
      const qtd = linhas.length;
      if (qtd === 0) return;
      const perc = (100 / qtd).toFixed(2);
      linhas.forEach(linha => {
        linha.cells[1].querySelector("input").value = perc;
      });
      desenharRoleta();
    }

    desenharRoleta();
    document.querySelectorAll("#tabela input").forEach(inp => inp.addEventListener("input", desenharRoleta));
  </script>
</body>
</html>
